version: 2
updates:
  # 1. GitHub Actions updates (weekly consolidated, minor/patch grouped)
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "sunday"
      time: "04:00"
      timezone: "Etc/UTC"
    open-pull-requests-limit: 5
    labels: ["dependencies", "github-actions"]
    commit-message:
      prefix: "chore(actions)"
    groups:
      gha-minor-patch:
        applies-to: version-updates
        update-types: ["minor", "patch"]

  # 2. NPM dependencies (web workspace) – daily security, weekly version updates grouped
  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "weekly"
      day: "sunday"
      time: "04:30"
      timezone: "Etc/UTC"
    open-pull-requests-limit: 10
    labels: ["dependencies", "npm"]
    allow:
      - dependency-type: "direct"
    commit-message:
      prefix: "chore(npm)"
    groups:
      web-minor-patch:
        applies-to: version-updates
        update-types: ["minor", "patch"]
      web-major-react:
        applies-to: version-updates
        patterns: ["react", "react-dom"]
        update-types: ["major"]
      web-security:
        applies-to: security-updates
        patterns: ["*"]

  # 2b. NPM security-only (separate daily scan) – isolates CVE fixes quickly
  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "daily"
      time: "05:00"
      timezone: "Etc/UTC"
    allow:
      - dependency-type: "direct"
      - dependency-type: "indirect"
    open-pull-requests-limit: 2
    labels: ["dependencies", "security", "npm"]
    commit-message:
      prefix: "chore(npm-security)"
      include: "scope"
    rebase-strategy: "auto"

  # 3. (Optional) Root-level npm (enable later if root gains deps)
  # - package-ecosystem: "npm"
  #   directory: "/"
  #   schedule:
  #     interval: "monthly"
  #   commit-message:
  #     prefix: "chore(npm-root)"
